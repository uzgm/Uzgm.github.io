<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>댕댕이 달리기 - zgm Studio</title>
    <style>
        :root {
            --bg-color: #fdf5e6;
            --dog-brown: #c9b4a1;
            --nose-black: #1a1a1a;
        }
        body {
            margin: 0; padding: 0; overflow: hidden;
            background-color: var(--bg-color);
            font-family: 'Pretendard', sans-serif;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            height: 100vh;
        }
        .ui {
            position: absolute; top: 40px; text-align: center; z-index: 10;
        }
        .score-board {
            font-size: 3rem; font-weight: 900; color: var(--dog-brown);
            text-shadow: 2px 2px 0px white;
        }
        #gameCanvas {
            background: #fff;
            border: 8px solid var(--dog-brown);
            border-radius: 50px;
            box-shadow: 0 20px 60px rgba(165, 140, 120, 0.3);
            max-width: 95%;
        }
        .msg { color: #8d6e63; margin-top: 10px; font-weight: bold; }
    </style>
</head>
<body>

    <div class="ui">
        <div class="score-board" id="score">0</div>
        <div class="msg">점프: 클릭 또는 Space</div>
    </div>
    
    <canvas id="gameCanvas"></canvas>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const scoreDisplay = document.getElementById('score');

        canvas.width = 800;
        canvas.height = 400;

        // 게임 변수
        let score = 0;
        let gameSpeed = 6;
        let isGameOver = false;

        // 댕댕이 캐릭터 (기획대로 캡슐형 기반)
        const puppy = {
            x: 80,
            y: 300,
            width: 50,
            height: 70,
            color: '#c9b4a1',
            dy: 0,
            jumpForce: 13,
            gravity: 0.6,
            isGrounded: false,

            draw() {
                // 1. 몸통 (캡슐형)
                ctx.fillStyle = this.color;
                ctx.beginPath();
                ctx.roundRect(this.x, this.y, this.width, this.height, 25);
                ctx.fill();

                // 2. 귀 (사진 포인트 반영)
                ctx.fillStyle = '#8d6e63';
                ctx.beginPath();
                ctx.ellipse(this.x + 5, this.y + 10, 10, 20, Math.PI/4, 0, Math.PI*2);
                ctx.ellipse(this.x + 45, this.y + 10, 10, 20, -Math.PI/4, 0, Math.PI*2);
                ctx.fill();

                // 3. 눈과 코 (촉촉한 검은 코)
                ctx.fillStyle = '#1a1a1a';
                ctx.beginPath(); ctx.arc(this.x + 15, this.y + 25, 4, 0, Math.PI*2); ctx.fill(); // 왼쪽 눈
                ctx.beginPath(); ctx.arc(this.x + 35, this.y + 25, 4, 0, Math.PI*2); ctx.fill(); // 오른쪽 눈
                ctx.beginPath(); ctx.ellipse(this.x + 25, this.y + 35, 6, 4, 0, 0, Math.PI*2); ctx.fill(); // 코
            },

            jump() {
                if (this.isGrounded) {
                    this.dy = -this.jumpForce;
                    this.isGrounded = false;
                }
            },

            update() {
                this.dy += this.gravity;
                this.y += this.dy;

                // 바닥 체크
                if (this.y + this.height > canvas.height - 20) {
                    this.y = canvas.height - 20 - this.height;
                    this.dy = 0;
                    this.isGrounded = true;
                }
                this.draw();
            }
        };

        // 장애물 클래스
        class Obstacle {
            constructor() {
                this.width = 40 + Math.random() * 30;
                this.height = 40 + Math.random() * 40;
                this.x = canvas.width;
                this.y = canvas.height - 20 - this.height;
                this.color = '#ff6f61';
            }

            draw() {
                ctx.fillStyle = this.color;
                ctx.beginPath();
                ctx.roundRect(this.x, this.y, this.width, this.height, 10);
                ctx.fill();
            }

            update() {
                this.x -= gameSpeed;
                this.draw();
            }
        }

        let obstacles = [];
        let timer = 0;

        function animate() {
            if (isGameOver) return;
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // 바닥 선
            ctx.strokeStyle = '#c9b4a1';
            ctx.lineWidth = 5;
            ctx.beginPath();
            ctx.moveTo(0, canvas.height - 20);
            ctx.lineTo(canvas.width, canvas.height - 20);
            ctx.stroke();

            puppy.update();

            // 장애물 생성 (점점 빨라짐)
            timer++;
            if (timer % Math.max(20, (100 - Math.floor(score/2))) === 0) {
                obstacles.push(new Obstacle());
            }

            obstacles.forEach((obs, index) => {
                obs.update();

                // 충돌 판정
                if (puppy.x < obs.x + obs.width &&
                    puppy.x + puppy.width > obs.x &&
                    puppy.y < obs.y + obs.height &&
                    puppy.y + puppy.height > obs.y) {
                    gameOver();
                }

                // 점수 획득
                if (obs.x + obs.width < 0) {
                    obstacles.splice(index, 1);
                    score++;
                    scoreDisplay.innerText = score;
                    if (score % 5 === 0) gameSpeed += 0.2; // 난이도 상승
                }
            });

            requestAnimationFrame(animate);
        }

        function gameOver() {
            isGameOver = true;
            alert(`으악! 댕댕이가 넘어졌다!\n최종 점수: ${score}\n다시 하려면 확인을 누르개!`);
            location.reload();
        }

        // 제어
        window.addEventListener('keydown', (e) => { if (e.code === 'Space') puppy.jump(); });
        window.addEventListener('mousedown', () => puppy.jump());

        animate();
    </script>
</body>
</html>
