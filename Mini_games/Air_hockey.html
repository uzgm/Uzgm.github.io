<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>13ì  ë‚´ê¸°! ëŒ•ëŒ• ì—ì–´í•˜í‚¤</title>
    <style>
        body { margin: 0; background: #1e272e; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; overflow: hidden; font-family: sans-serif; touch-action: none; }
        canvas { background: #34495e; border: 10px solid #ecf0f1; border-radius: 10px; box-shadow: 0 0 20px rgba(0,0,0,0.5); }
        .score { position: absolute; left: -60px; transform: rotate(90deg); color: white; font-size: 24px; font-weight: bold; width: 200px; text-align: center; }
        /* ìŠ¹ë¦¬ íŒì—… ìŠ¤íƒ€ì¼ */
        #win-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); color: gold; flex-direction: column; justify-content: center; align-items: center; z-index: 1000; font-size: 40px; font-weight: bold; }
        #win-overlay button { margin-top: 20px; padding: 15px 30px; font-size: 20px; cursor: pointer; border-radius: 10px; border: none; background: #ff7675; color: white; }
    </style>
</head>
<body>

<div id="win-overlay">
    <div id="win-message">P1 WIN!</div>
    <button onclick="resetGame()">ë³µìˆ˜í•˜ê¸° (ë‹¤ì‹œ ì‹œì‘)</button>
</div>

<div style="position: relative;">
    <div class="score" style="top: 100px;">P2: <span id="s2">0</span></div>
    <div class="score" style="bottom: 100px;">P1: <span id="s1">0</span></div>
    <canvas id="hockeyCanvas"></canvas>
</div>

<script>
    const canvas = document.getElementById('hockeyCanvas');
    const ctx = canvas.getContext('2d');
    const s1El = document.getElementById('s1'), s2El = document.getElementById('s2');
    const overlay = document.getElementById('win-overlay');
    const winMsg = document.getElementById('win-message');

    canvas.width = 320;
    canvas.height = 500;

    let s1 = 0, s2 = 0;
    let isGameOver = false;

    let puck = { x: 160, y: 250, vx: 0, vy: 0, r: 15, color: '#f1c40f' };
    let p1 = { x: 160, y: 450, r: 25, color: '#ff7675' }; 
    let p2 = { x: 160, y: 50, r: 25, color: '#74b9ff' };  

    canvas.addEventListener('touchmove', (e) => { 
        if (isGameOver) return;
        Array.from(e.changedTouches).forEach(t => {
            let rect = canvas.getBoundingClientRect();
            let x = t.clientX - rect.left, y = t.clientY - rect.top;
            if (y > 250) { p1.x = x; p1.y = y; }
            else { p2.x = x; p2.y = y; }
        });
    });

    function update() {
        if (isGameOver) return;

        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.strokeStyle = "rgba(255,255,255,0.2)";
        ctx.setLineDash([10, 10]);
        ctx.beginPath(); ctx.moveTo(0, 250); ctx.lineTo(320, 250); ctx.stroke();

        puck.x += puck.vx; puck.y += puck.vy;
        puck.vx *= 0.98; puck.vy *= 0.98;

        if (puck.x < puck.r || puck.x > canvas.width - puck.r) puck.vx *= -1;
        
        // ê³¨ì¸ íŒì • ë° 13ì  ì²´í¬
        if (puck.y < 0) { s1++; s1El.innerText = s1; checkWin(); resetPuck(); }
        if (puck.y > canvas.height) { s2++; s2El.innerText = s2; checkWin(); resetPuck(); }

        [p1, p2].forEach(p => {
            let dx = puck.x - p.x, dy = puck.y - p.y;
            let dist = Math.hypot(dx, dy);
            if (dist < puck.r + p.r) {
                let angle = Math.atan2(dy, dx);
                puck.vx = Math.cos(angle) * 12;
                puck.vy = Math.sin(angle) * 12;
            }
            drawCircle(p.x, p.y, p.r, p.color);
        });

        drawCircle(puck.x, puck.y, puck.r, puck.color);
        requestAnimationFrame(update);
    }

    function checkWin() {
        if (s1 >= 13) showWin("P1 WINNER! ğŸ‰");
        else if (s2 >= 13) showWin("P2 WINNER! ğŸ†");
    }

    function showWin(msg) {
        isGameOver = true;
        winMsg.innerText = msg;
        overlay.style.display = 'flex';
    }

    function resetGame() {
        s1 = 0; s2 = 0;
        s1El.innerText = 0; s2El.innerText = 0;
        isGameOver = false;
        overlay.style.display = 'none';
        resetPuck();
        update();
    }

    function drawCircle(x, y, r, color) {
        ctx.beginPath(); ctx.arc(x, y, r, 0, Math.PI * 2);
        ctx.fillStyle = color; ctx.fill();
        ctx.strokeStyle = 'white'; ctx.lineWidth = 2; ctx.stroke(); ctx.closePath();
    }

    function resetPuck() { puck.x = 160; puck.y = 250; puck.vx = 0; puck.vy = 0; }

    update();
</script>
</body>
</html>
